---
title: "biol706 final project"
author: "Reilly Richardson"
format: html
editor: visual
---

# BIOL706 Final Project: Malaria Atlas Data

This project is for my BIOL706 final. I made this change in Github to see if pulling worked.

# Africa

```{r echo=FALSE}

library(tidyverse)
library(RColorBrewer)
library(malariaAtlas)

#retrieve data from Africa for both species of plasmodium (separately) from Malaria Atlas 
Africa_pvpr_data_pf <- getPR(continent = "Africa", species = "pf") 
Africa_pvpr_data_pv <- getPR(continent = "Africa", species = "pv")

```

```{r echo = FALSE}
autoplot(Africa_pvpr_data_pf)
autoplot(Africa_pvpr_data_pv)
#quickly autoplot most recent version of parasite rate data for each species in africa
```

```{r echo = FALSE}

library(forcats)

#pr = positive/examined

PF_Africa_table <- Africa_pvpr_data_pf %>% 
  drop_na(pr) %>% #have to drop na pr data
  filter(year_start>2009) %>% 
  group_by(country) %>% 
  summarize(mean_pr = mean(pr))


PV_Africa_table <- Africa_pvpr_data_pv %>% 
  drop_na(pr) %>% #have to drop na pr data
  filter(year_start>2009) %>% 
  group_by(country) %>% 
  summarize(mean_pr = mean(pr)) %>% 
  filter(mean_pr>0)

  
ggplot(data = PV_Africa_table, mapping = aes(x=fct_reorder(country, mean_pr), y = mean_pr, fill = mean_pr)) +
  geom_bar(stat="identity") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 18)) + #wrap label text
  theme(text = element_text(size = 10),
  axis.text.x = element_text(angle = 90, hjust = 1)) + 
  labs (title = 'Positivity rate for infection with Plasmodium vivax across Africa', 
        subtitle = 'data averaged from 2010-2020',
        x = 'country', 
        y = 'mean positivity rate')

ggplot(data = PF_Africa_table, mapping = aes(x=fct_reorder(country, mean_pr), y = mean_pr, fill = mean_pr)) +
  geom_bar(stat="identity") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 35)) + #wrap label text
  theme(text = element_text(size = 10),
  axis.text.x = element_text(angle = 90, hjust = 1)) + 
  labs (title = 'Positivity rate for infection with Plasmodium falciparum across Africa', 
        subtitle = 'data averaged from 2010-2020',
        x = 'country', 
        y = 'mean positivity rate')

```

# Burkina Faso

```{r echo = FALSE}
bf_vec <- getVecOcc(ISO="BFA") #get vector occurence data if I want to use later?
```

Highest pr between both was P. falciparum in Burkina Faso Look at rural vs urban? Look at pos rates over time RDT is a malaria diagnostic test Have to exclude DHS data - mention in methods, not open access

```{r echo = FALSE}
pf_burkina_faso <- getPR(country = "Burkina Faso", species = "pf")
```

```{r echo = FALSE}
pf_burkina_faso <- getPR(country = "Burkina Faso", species = "pf")
```

## positivity rate and total number of positives from 2010-2017

```{r echo = FALSE}
PF_BF_table_pr <- pf_burkina_faso %>% 
  drop_na(pr) %>% #have to drop na pr data
  filter(year_start>2009) %>% 
  group_by(year_start) %>% 
  summarize(mean_pr = mean(pr))

PF_BF_table_total_pos <- pf_burkina_faso %>% 
  drop_na(pr) %>% #have to drop na pr data
  filter(year_start>2009) %>% 
  group_by(year_start) %>%
  summarize(total_pos = sum(positive)) 

ggplot(data = PF_BF_table_pr, mapping = aes(x = year_start, y=mean_pr))+
  geom_point() + 
  labs(title = 'Positivity rate for infection with P. falciparum at sites in Burkina Faso, 2010-2017')

ggplot(data = PF_BF_table_total_pos, mapping = aes(x = year_start, y=total_pos))+
  geom_point() + 
  labs(title = 'Total positives for infection with P. falciparum at sites in Burkina Faso, 2010-2017')


```

There were only two survey sites in 2017

```{r}
autoplot(pf_burkina_faso)
```

## rural vs urban

could I do an anova here?

```{r echo = FALSE}

rural_urban_bf <- pf_burkina_faso %>% 
  filter(year_start>2009)

ggplot(data = rural_urban_bf, mapping = aes(x = rural_urban, y = pr, fill = pr)) + 
  geom_boxplot()
  
```

# Globally

## Looking at plasmodium vivax, omitting DHS data and confidential data (would have to request)

```{r echo = FALSE}

global_pv <- getPR(country ="all", species = "pv") 
global_pf <- getPR(country ="all", species = "pf") 

```

```{r echo = FALSE}
autoplot(global_pv)
```

```{r echo = FALSE}
autoplot(global_pf)
```

```{r}
PF_global_table <- global_pf %>% 
  drop_na(pr) %>% #have to drop na pr data
  filter(year_start>2009) %>% 
  group_by(country) %>% 
  summarize(mean_pr = mean(pr)) %>% 
  filter(mean_pr>0)


PV_global_table <- global_pv %>% 
  drop_na(pr) %>% #have to drop na pr data
  group_by(country) %>% 
  summarize(mean_pr = mean(pr)) %>% 
  filter(mean_pr>0)

ggplot(data = PV_global_table, mapping = aes(x=fct_reorder(country, mean_pr), y = mean_pr, fill = mean_pr)) +
  geom_bar(stat="identity") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 18)) + #wrap label text
  theme(text = element_text(size = 10),
  axis.text.x = element_text(angle = 90, hjust = 1)) + 
  labs (title = 'Positivity rate for infection with Plasmodium vivax', 
        subtitle = 'data averaged from 2010-2020',
        x = 'country', 
        y = 'mean positivity rate')

ggplot(data = PF_global_table, mapping = aes(x=fct_reorder(country, mean_pr), y = mean_pr, fill = mean_pr)) +
  geom_bar(stat="identity") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 35)) + #wrap label text
  theme(text = element_text(size = 10),
  axis.text.x = element_text(angle = 90, hjust = 1)) + 
  labs (title = 'Positivity rate for infection with Plasmodium falciparum', 
        subtitle = 'data averaged from 2010-2020',
        x = 'country', 
        y = 'mean positivity rate')

```
